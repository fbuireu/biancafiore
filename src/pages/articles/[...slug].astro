---
import { type CollectionEntry, getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import BaseLayout from 'src/ui/components/templates/baseLayout/BaseLayout.astro';
import './_article.css';

type ArticleProps = CollectionEntry<'articles'>;

export async function getStaticPaths() {
    const posts = await getCollection('articles');
    return posts.map(({ slug, ...post }) => ({
        params: { slug },
        props: { post },
    }));
}

const { post } = Astro.props as ArticleProps;
const { Content } = await post.render();
const images = import.meta.glob('/src/assets/**/*.{jpeg,jpg,png,gif}');
---

<BaseLayout {...post.data}>
    {
        post.data.featuredImage && (
            <section class="article__featured__image__wrapper">
                <Image
                    src={images[post.data.featuredImage]()}
                    alt={post.data.title}
                    class="article__featured__image"
                    transition:animate="slide"
                />
            </section>
        )
    }
    <h1 class="article__title">
        {post.data.title}
    </h1>
    <p>by {post.data.author}</p>
    <time class="font-sans-serif" datetime={post.data.publishDate}>
        {post.data.publishDate}
    </time>
    <article class="article__wrapper">
        <Content />
    </article>
</BaseLayout>
